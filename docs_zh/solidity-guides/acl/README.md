# 访问控制列表

本文档描述了 FHEVM 中的访问控制列表 (ACL) 系统，这是一个管理加密数据访问的核心功能。ACL 确保只有授权的帐户或合约才能与特定的密文进行交互，从而在启用可组合的智能合约的同时保护机密性。本概述提供了对 ACL 是什么、为什么它至关重要以及它如何工作的高级理解。

## 什么是 ACL？

ACL 是一个权限管理系统，旨在控制谁可以访问、计算或解密 fhevm 中的加密值。通过定义和强制执行这些权限，ACL 确保加密数据在授权的上下文中保持安全且可用。

## 为什么 ACL 很重要？

FHEVM 中的加密数据是完全机密的，这意味着如果没有适当的访问控制，即使是持有密文的合约也无法与其交互。ACL 支持：

- **精细的权限**：为单个帐户或合约定义特定的访问规则。
- **安全计算**：确保只有授权实体才能操作或解密加密数据。
- **Gas 效率**：使用瞬态访问来优化临时需求的权限，从而降低存储和 gas 成本。

## ACL 如何工作？

### 访问类型

- **永久许可**：
  - 使用 `FHE.allow(ciphertext, address)` 进行配置。
  - 授予特定地址对密文的长期访问权限。
  - 存储在专用合约中以实现持久存储。
- **瞬态许可**：
  - 使用 `FHE.allowTransient(ciphertext, address)` 进行配置。
  - 仅在当前交易期间授予对密文的访问权限。
  - 存储在瞬态存储中，从而降低 gas 成本。
  - 非常适合将密文传递给外部函数等临时操作。
- **永久公共许可**：
  - 使用 `FHE.makePubliclyDecryptable(ciphertext)` 进行配置。
  - 授予任何用户对密文的长期访问权限。
  - 存储在专用合约中以实现持久存储。

**语法糖**：

- `FHE.allowThis(ciphertext)` 是 `FHE.allow(ciphertext, address(this))` 的简写。它授权当前合约在将来的交易中重用密文句柄。

### 瞬态与永久许可

| 许可类型 | 目的 | 存储类型 | 用例 |
| --- | --- | --- | --- |
| **瞬态** | 交易期间的临时访问。 | [瞬态存储](https://eips.ethereum.org/EIPS/eip-1153) (EIP-1153) | 使用密文调用外部函数或计算。在希望节省 gas 成本时使用。 |
| **永久** | 跨多个交易的长期访问。 | 专用合约存储 | 需要持续访问的合约或用户的持久密文。 |

## 授予和验证访问权限

### 授予访问权限

开发人员可以使用 `allow`、`allowThis` 和 `allowTransient` 等函数来授予权限：

- **`allow`**：授予地址永久访问权限。
- **`allowThis`**：授予当前合约操作密文的访问权限。
- **`allowTransient`**：在当前交易期间授予地址临时访问权限。

### 验证访问权限

要检查实体是否具有访问密文的权限，请使用 `isAllowed` 或 `isSenderAllowed` 等函数：

- **`isAllowed`**：验证特定地址是否具有权限。
- **`isSenderAllowed`**：简化对当前交易发送者的检查。

## ACL 的实际用途

- **机密参数**：在合约之间安全地传递加密值，确保只有授权实体才能访问它们。
- **安全状态管理**：存储加密的状态变量，同时控制谁可以修改或读取它们。
- **保护隐私的计算**：在确保权限得到强制执行的情况下，对加密数据进行计算。

---

有关 ACL 功能的详细说明，包括代码示例和高级配置，请参阅 [ACL 示例](acl_examples.md)。
