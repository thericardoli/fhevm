# 网关

本文档解释了 Zama 协议的关键组件之一——网关，Zama FHEVM 协议中的中央协调器，协调用户、主机链、协处理器和密钥管理服务（KMS）之间的交互，确保加密数据在系统中安全正确地流动。

## 什么是网关？

网关是一个专门的区块链组件（实现为 Arbitrum rollup），负责管理：

- 来自用户和应用程序的加密输入的验证。
- 跨不同区块链的加密密文的桥接。
- 通过 KMS 节点的解密协调。
- 分散式协处理器之间的共识强制执行。
- 参与 FHE 计算的运营商的抵押和奖励分配。

它被设计为信任最小化：计算是独立可验证的，并且网关本身不存储任何敏感数据或解密密钥。

## 网关的职责

### 加密输入验证

网关确保用户提供的加密值是格式正确且有效的。它通过以下方式做到这一点：

- 接受加密输入以及零知识知识证明（ZKPoK）。
- 为协处理器发出验证事件以进行验证。
- 聚合来自大多数协处理器的签名以生成证明，然后可以在链上用作
  受信任的外部值。

### 访问控制协调

网关维护来自主机链的访问控制列表（ACL）的同步副本，使其能够独立
确定是否应授予密文的解密或计算权限。这有助于强制执行：

- 访问权限（允许）
- 公共解密权限（allowForDecryption）

这些 ACL 更新由协处理器复制并推送到网关进行验证和强制执行。

### 解密协调

当智能合约或用户请求解密加密值时：

1. 网关验证 ACL 权限。
2. 然后它触发 KMS 解密（公开或私下）。
3. 一旦 KMS 返回签名的结果，网关就会发出可以由预言机（用于智能合约
   解密）或返回给用户（用于私下解密）的事件。

这确保了异步、安全和可审计的解密，而网关本身不知道明文。

### 跨链桥接

网关还处理主机链之间加密句柄的桥接。它：

- 使用其 ACL 副本验证源链上的访问权限。
- 请求协处理器为目标链计算新的句柄。
- 从协处理器收集签名。

颁发允许这些句柄在目标链上使用的证明。

### 共识和削减强制执行

网关在分散的协处理器和 KMS 节点之间强制执行共识。如果出现差异：

- 协处理器必须提供对密文的承诺。
- 欺诈或不正确的行为可能会受到挑战和削减。
- 必要时可以触发治理机制进行链下验证。

### 协议管理

网关运行管理以下内容的智能合约：

- 运营商和参与者注册（协处理器、KMS 节点、主机链）
- 密钥管理和轮换
- 桥接逻辑
- 输入验证和解密工作流程

## 安全和信任假设

网关被设计为在不需要信任的情况下运行：

- 它本身不执行任何计算——它只是协调和验证。
- 所有操作都经过签名，并且加密验证内置于每个步骤中。

该协议假定网关在安全保证方面不受信任——如果需要，它可以被完全审计和替换。
