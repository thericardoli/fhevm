# 网关

本文档解释了 Zama 协议的关键组件之一——网关，Zama 的 FHEVM 协议中的中央协调器，协调用户、主机链、协处理器和密钥管理服务（KMS）之间的交互，确保加密数据安全正确地流经系统。

## 什么是网关？

网关是一个专门的区块链组件（实现为 Arbitrum rollup），负责管理：

- 验证来自用户和应用程序的加密输入。
- 跨不同区块链桥接加密密文。
- 通过 KMS 节点进行解密协调。
- 在去中心化协处理器之间执行共识。
- 向参与 FHE 计算的操作员分配质押和奖励。

它被设计为最小化信任：计算是独立可验证的，网关本身不存储任何敏感数据或解密密钥。

## 网关的职责

### 加密输入验证

网关确保用户提供的加密值格式良好且有效。它通过以下方式实现：

- 接受加密输入以及知识零知识证明（ZKPoK）。
- 为协处理器验证发出验证事件。
- 聚合来自大多数协处理器的签名以生成证明，然后可以在链上用作\
  可信的外部值。

### 访问控制协调

网关维护来自主机链的访问控制列表（ACL）的同步副本，使其能够独立\
确定是否应授予密文的解密或计算权限。这有助于执行：

- 访问权限（允许）
- 公共解密权限（allowForDecryption）

这些 ACL 更新由协处理器复制并推送到网关进行验证和执行。

### 解密协调

当智能合约或用户请求解密加密值时：

1. 网关验证 ACL 权限。
2. 然后触发 KMS 进行解密（公开或私密）。
3. 一旦 KMS 返回签名的结果，网关发出可以由预言机（用于智能合约\
   解密）拾取或返回给用户（用于私密解密）的事件。

这确保了异步、安全和可审计的解密，而网关本身不知道明文。

### 跨链桥接

网关还处理主机链之间加密句柄的桥接。它：

- 使用其 ACL 副本验证源链上的访问权限。
- 请求协处理器为目标链计算新的句柄。
- 从协处理器收集签名。

发出证明，允许这些句柄在目标链上使用。

### 共识和削减执行

网关在去中心化协处理器和 KMS 节点之间执行共识。如果出现差异：

- 协处理器必须提供密文的承诺。
- 可以挑战和削减欺诈或不正确的行为。
- 必要时可以触发治理机制进行链外验证。

### 协议管理

网关运行管理以下内容的智能合约：

- 操作员和参与者注册（协处理器、KMS 节点、主机链）
- 密钥管理和轮换
- 桥接逻辑
- 输入验证和解密工作流程

## 安全和信任假设

网关被设计为在不需要信任的情况下运行：

- 它本身不执行任何计算——它只是协调和验证。
- 所有操作都经过签名，密码学验证内置于每一步。

该协议在安全保证方面不假设对网关的信任——如有必要，可以对其进行完全审计和替换。
