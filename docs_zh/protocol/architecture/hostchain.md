# 主机合约

本文档解释了 Zama 协议的关键组件之一——主机合约。

## 什么是主机合约？

主机合约是部署在任何支持的区块链（EVM 或非 EVM）上的智能合约，充当链上应用程序与 FHEVM 协议之间的可信桥梁。它们作为机密智能合约使用的最小且基础的接口，用于：

- 与加密数据（句柄）交互
- 执行访问控制操作
- 为链外组件（协处理器、网关）发出事件

这些主机合约由开发人员通过 FHEVM Solidity 库间接使用，抽象了复杂性并顺利集成到现有工作流程中。

## 主机合约的职责

### 可信接口层

主机合约是唯一的链上组件：

- 维护和执行密文的访问控制列表（ACL）。
- 发出触发协处理器执行的事件。
- 验证访问权限（持久、临时或与解密相关）。

它们实际上是以下方面的链上权威：

- 谁被允许访问密文
- 何时以及如何使用它
- 这些 ACL 在网关上镜像，用于链外执行和桥接。

### 访问控制 API

主机合约通过标准化函数调用（由 FHEVM 库包装）公开访问控制逻辑：

- `allow(handle, address)`：授予持久访问权限。
- `allowTransient(handle, address)`：为单个交易授予临时访问权限。
- `allowForDecryption(handle)`：将句柄标记为可公开解密。
- `isAllowed(handle, address)`：返回给定地址是否有访问权限。
- `isSenderAllowed(handle)`：检查 msg.sender 是否被允许使用句柄。

它们还发出：

- `Allowed(handle, address)`
- `AllowedForDecryption(handle)`

这些事件对于触发协处理器状态更新和确保正确的 ACL 复制到网关至关重要。

→ 参见完整指南 [ACL](https://docs.zama.ai/protocol/solidity-guides/smart-contract/acl)。

### 安全角色

尽管 FHE 计算发生在链外，但主机合约在协议安全方面发挥着关键作用：

- 执行基于 ACL 的门控
- 确保只有经过授权的合约和用户才能解密或使用句柄
- 防止加密数据的滥用（例如，在没有访问权限的情况下进行计算）

没有适当授权的访问尝试将在智能合约级别被拒绝，保护机密操作的完整性和用户隐私。
