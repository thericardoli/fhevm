# 主机合约

本文档解释了 Zama 协议的关键组件之一——主机合约。

## 什么是主机合约？

主机合约是部署在任何受支持的区块链（EVM 或非 EVM）上的智能合约，充当链上应用程序和 FHEVM 协议之间的受信任桥梁。它们是机密智能合约用于以下目的的最小和基础接口：

- 与加密数据（句柄）交互
- 执行访问控制操作
- 为链下组件（协处理器、网关）发出事件

开发人员通过 FHEVM Solidity 库间接使用这些主机合约，从而抽象出复杂性并平滑地集成到现有工作流程中。

## 主机合约的职责

### 受信任的接口层

主机合约是唯一的链上组件，可：

- 维护和强制执行密文的访问控制列表（ACL）。
- 发出触发协处理器执行的事件。
- 验证访问权限（持久、瞬态或与解密相关）。

它们实际上是链上权威，负责：

- 谁被允许访问密文
- 他们何时以及如何使用它
- 这些 ACL 在网关上镜像，用于链下强制执行和桥接。

### 访问控制 API

主机合约通过标准化的函数调用（由 FHEVM 库包装）公开访问控制逻辑：

- `allow(handle, address)`：授予永久访问权限。
- `allowTransient(handle, address)`：授予单个交易的临时访问权限。
- `allowForDecryption(handle)`：将句柄标记为可公开解密。
- `isAllowed(handle, address)`：返回给定地址是否具有访问权限。
- `isSenderAllowed(handle)`：检查 msg.sender 是否被允许使用句柄。

它们还发出：

- `Allowed(handle, address)`
- `AllowedForDecryption(handle)`

这些事件对于触发协处理器状态更新和确保 ACL 正确复制到网关至关重要。

→ 查看 [ACL](https://docs.zama.ai/protocol/solidity-guides/smart-contract/acl) 的完整指南。

### 安全角色

尽管 FHE 计算在链下进行，但主机合约通过以下方式在协议安全中发挥着关键作用：

- 强制执行基于 ACL 的门控
- 确保只有授权的合约和用户才能解密或使用句柄
- 防止滥用加密数据（例如，无权访问的计算）

未经适当授权的访问尝试在智能合约级别被拒绝，从而保护了机密操作的完整性和用户隐私。
